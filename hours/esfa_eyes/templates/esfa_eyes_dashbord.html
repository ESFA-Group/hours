{% extends "base.html" %}
{% load static %}
{% load connector_template_filters %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'sheets/css/jspreadsheet.css' %}">
<link rel="stylesheet" href="{% static 'sheets/css/jspreadsheet.datatables.css' %}">
<link rel="stylesheet" href="{% static 'sheets/css/jspreadsheet.theme.css' %}">
<style>
    :root {
        --jexcel_header_color: #000;
        --jexcel_header_color_highlighted: #000;
        --jexcel_header_background: #f3f3f3;
        --jexcel_header_background_highlighted: #dcdcdc;
        --jexcel_content_color: #000;
        --jexcel_content_color_highlighted: #000;
        --jexcel_content_background: #fff;
        --jexcel_content_background_highlighted: rgba(0, 0, 0, 0.05);
        --jexcel_menu_background: #fff;
        --jexcel_menu_background_highlighted: #ebebeb;
        --jexcel_menu_color: #555;
        --jexcel_menu_color_highlighted: #555;
        --jexcel_menu_box_shadow: 2px 2px 2px 0px rgba(143, 144, 145, 1);
        --jexcel_border_color: #ccc;
        --jexcel_border_color_highlighted: #000;
        --jexcel_cursor: #eee;
        --active_color: #007aff;
    }

    /* .jexcel tbody tr td{
            background-color: rgba(200, 0, 0, 0.2);
        } */
    .redFont {
        color: red;
    }
</style>
{% endblock extra_css %}
{% block body %}


<div class="grid grid-cols-5 grid-rows-5 gap-3 bg-primary h-screen">
    <div class=>.</div>
    <div class=>2.</div>
    <div class=>.</div>
</div>


<script src="{% static 'sheets/js/esfa_persian_holidays.min.js' %}"></script>
<script src="{% static 'sheets/js/plotly-basic.min.js' %}"></script>
<script src="{% static 'sheets/js/jspreadsheet.min.js' %}"></script>
<script>

    async function initTable() {
        const year = $("#year").val();
        //let sheet = await getEsfaEyesInfo(year);

        //constructTable(sheet.data, sheet.submitted);
        onChangeHandler();
    }

    async function getEsfaEyesInfo(year) {
        const url = `{% url "esfa_eyes:api_eyes" year='yearHolder' %}`
            .replace("yearHolder", year)
        try {
            let res = await fetch(url);
            return await res.json();
        }
        catch (err) {
            jSuites.notification({
                error: 1,
                name: 'Error',
                title: "Fetching This month's Sheet",
                message: err,
            });
        }
    }

    async function constructTable(data, readOnlyAll = false) {

    }

    function saveSheet(data) {
        const year = $("#year").val();
        const month = $("#month").val();
        const url = `{% url "sheets:api_sheets" year='yearHolder' month='monthHolder' %}`
            .replace("yearHolder", year)
            .replace("monthHolder", month);
        fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{csrf_token}}',
            },
            body: JSON.stringify({ "data": data, "saveSheet": true }),
        })
            .then(res => res.json())
            .then(() => updatePaymentsValue())
            .catch(err => {
                jSuites.notification({
                    error: 1,
                    name: 'Error',
                    title: "Updating Sheet",
                    message: err,
                });
            });
    }

    function fillYears(year) {
        for (let i = window.START_YEAR; i <= year; i++) {
            $("#year").append($("<option>").text(i));
        }
    }


    $("document").ready(async function () {

        const today = new JDate();
        const currentYear = today.getFullYear();
        const currentMonth = today.getMonth();
        fillYears(currentYear);
        $("#year").val(currentYear);

        initTable();
        $("#year, #month").change(function () {
            initTable();
        });
    });

</script>
{% endblock body %}